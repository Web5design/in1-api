{"ts":1376130961126,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1376131145880,"patch":[[{"diffs":[[1,"var port = process.env.PORT || 4000,\r\n    app = require('./app').init(port),\r\n    img = require('./image'),\r\n    utils = require('./utils'),\r\n    conf = require('./conf'),\r\n    request = require('request');\r\n    \r\n/* default route */\r\napp.get('/', function(req,res){\r\n    \r\n    var urlToFetch = req.query[\"url\"],\r\n        apiKey = req.query[\"apiKey\"],\r\n        h = req.query.h,\r\n        w = req.query.w,\r\n        d = req.query.d,\r\n        q = req.query.q,\r\n        namedResolution = req.query.size,\r\n        wxh = req.query.wxh,\r\n        fresh = req.query.fresh||false;\r\n\r\n    if (!urlToFetch) {\r\n        console.log(\"show home page\");\r\n        res.render(\"index\");\r\n    }\r\n    else {\r\n        \r\n        urlToFetch = utils.fixUrl(urlToFetch,req.headers.host);\r\n        img.getImage(req,res,urlToFetch,paidServiceParams(h,w,q,d,\"browser\",namedResolution,wxh));\r\n    }\r\n});\r\n\r\nvar doResize = function(h,w){\r\n  \r\n    if ((h==75&&w==75)||(h==150&&w==150)||(h==600)) {\r\n        return false;\r\n    }\r\n    else {    \r\n        return true;\r\n    }\r\n    \r\n};\r\n\r\n/* given a cached url, redirect to proxy image */\r\napp.get('/cache', function(req,res,next){\r\n    console.log(\"cached\");\r\n    \r\n    var url = url;\r\n    \r\n     request.get({url:'https://api.parse.com/1/classes/Capture',json:true,qs:{where:JSON.stringify({url:url})},headers:{'X-Parse-Application-Id':conf.parse.appKey,'X-Parse-REST-API-Key':conf.parse.restKey}},function(e,r,b){\r\n        if (b.results[0]) {\r\n            var uuid =  b.results[0].uuid;\r\n            res.redirect(\"/\"+uuid);\r\n        }\r\n        else {\r\n            next();\r\n        }\r\n    });\r\n});\r\n\r\napp.get('/:id/:size?', function(req,res,next){\r\n    console.log(\"imageshack proxy\");\r\n    \r\n    var id = req.params.id;\r\n    var size = req.params.size||'full'; //mini,thumb,mobile,large,full\r\n    \r\n    request.get({url:'https://api.parse.com/1/classes/Capture/'+id,json:true,headers:{'X-Parse-Application-Id':conf.parse.appKey,'X-Parse-REST-API-Key':conf.parse.restKey}},function(e,r,b){\r\n        if (b) {\r\n            var item = b;\r\n            request({url:item.link}).pipe(res);\r\n        }\r\n    });\r\n});\r\n\r\n\r\n\r\napp.get('/preview', function(req, res){\r\n    res.render('preview');\r\n});\r\n\r\napp.get('/api', function(req, res){\r\n    res.render('api');\r\n});\r\n\r\napp.get('/proxy', function(req, res){\r\n    if (req.param(\"purl\")) {\r\n        request(unescape(req.param(\"purl\")), function (error, response, body) {\r\n\t\t\tif (!error && response.statusCode == 200) {\r\n\t\t\t\tres.send(body);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tres.json({error:\"Bad URL request.\"});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n    else {\r\n        res.json({error:\"URL is required.\"});\r\n    }\r\n});\r\n\r\n/* The 404 Route (ALWAYS Keep this as the last route) */\r\napp.get('/*', function(req, res){\r\n    res.render('404.ejs');\r\n});\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":2772}]],"length":2772,"saved":false}
{"ts":1376131602568,"patch":[[{"diffs":[[0,"),\r\n"],[-1,"    img = require('./image'),\r\n"],[0,"    "]],"start1":74,"start2":74,"length1":39,"length2":8}]],"length":2741,"saved":false}
{"ts":1376131658567,"patch":[[{"diffs":[[0,"ry.w"],[-1,",\r\n        d = req.query.d,\r\n        q = req.query.q,\r\n        namedResolution = req.query.size,\r\n        wxh = req.query.wxh,\r\n        fresh = req.query.fresh||false"],[0,""],[1,""],[0,";\r\n\r"]],"start1":367,"start2":367,"length1":174,"length2":8},{"diffs":[[0,"        "],[1,"//"],[0,"img.getI"]],"start1":564,"start2":564,"length1":16,"length2":18},{"diffs":[[0,"\r\n\r\n"],[-1,"var doResize = function(h,w){\r\n  \r\n    if ((h==75&&w==75)||(h==150&&w==150)||(h==600)) {\r\n        return false;\r\n    }\r\n    else {    \r\n        return true;\r\n    }\r\n    \r\n};\r\n\r\n"],[0,"/* g"]],"start1":676,"start2":676,"length1":185,"length2":8}]],"length":2400,"saved":false}
{"ts":1376131797563,"patch":[[{"diffs":[[0,"\n   "],[-1," \r\n    var urlToFetch = req.query[\"url\"],\r\n        apiKey = req.query[\"apiKey\"],\r\n        h = req.query.h,\r\n        w = req.query.w;\r\n\r\n    if (!urlToFetch) {\r\n        console.log(\"show home page\");\r\n        res.render(\"index\");\r\n    }\r\n    else {\r\n        \r\n        urlToFetch = utils.fixUrl(urlToFetch,req.headers.host);\r\n        //img.getImage(req,res,urlToFetch,paidServiceParams(h,w,q,d,\"browser\",namedResolution,wxh));\r\n    }"],[1,"res.render(\"index\");"],[0,"\r\n})"]],"start1":236,"start2":236,"length1":439,"length2":28},{"diffs":[[0,"req,res,next){\r\n"],[1,""],[0,"    console.log("]],"start1":347,"start2":347,"length1":32,"length2":32},{"diffs":[[0,"\"cached\");\r\n"],[-1,"    \r\n"],[0,"    var url "]],"start1":379,"start2":379,"length1":30,"length2":24}]],"length":1983,"saved":false}
{"ts":1376131975453,"patch":[[{"diffs":[[0,"\n});\r\n\r\n"],[1,"app.get('/fetch', function(req,res){\r\n    \r\n   var url = req.query.url;\r\n   \r\n   \r\n   \r\n    \r\n   res.render(\"index\");\r\n});\r\n\r\n\r\n"],[0,"/* given"]],"start1":261,"start2":261,"length1":16,"length2":144}]],"length":2111,"saved":false}
{"ts":1376134091508,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"app.get('/fetch', function(req,res){\r\n    \r\n   var url = req.query.url;\r\n   \r\n   \r\n   \r\n    \r\n   res.render(\"index\");"],[1,"// get basic media and social media data from a url\r\napp.get('/harvest', function(req,res){ \r\n    \r\n   var url = req.query.url;\r\n   \r\n   var url = req.param(\"url\"),\r\n    \ttitle,\r\n\t\tdesc,\r\n\t\timage,\r\n\t\timages=[],\r\n\t\ttags=[],\r\n\t\ttw,fb,rss,li,pin,yt,\r\n\t\ttitleFound=0,\r\n\t\tdescFound=0,\r\n\t\timgFound=0;\r\n\t\r\n\tif (url) {\r\n\t\r\n\t\tvar sURL = unescape(url);\r\n\t\t\r\n\t\trequest({url:sURL,followRedirect:true,maxRedirects:1}, function (error, response, body) {\r\n\t\t\r\n\t\t\tif (!error) {\r\n\t\t\t\t$h = $(\"<form>\"+body+\"</form>\");\r\n\t\t\t\t\r\n\t\t\t\t// find opengraph\r\n\t\t\t\t$.each($h.find('meta[property^=\"og:\"]'),function(idx,item){\r\n\t\t\t\t\t$item = $(item);\r\n\t\t\t\t\tproperty = $item.attr(\"property\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (property==\"og:image\") {\r\n\t\t\t\t\t\timage = $item.attr(\"content\");\r\n\t\t\t\t\t\t//if (imgSrc.indexOf('//')==-1) { // prepend baseurl for relative images\t\t\t\t\t\t\r\n\t\t\t\t\t\t//\timgSrc=baseUrl+imgSrc;\r\n\t\t\t\t\t\t//}\r\n\t\t\t\t\t\timages.push(image);\r\n\t\t\t\t\t\timgFound = 1;\r\n\t\t\t\t\t}\t\t\t\r\n\t\t\t\t\telse if (property==\"og:title\") {\r\n\t\t\t\t\t\ttitle = $item.attr(\"content\");\r\n\t\t\t\t\t\ttitleFound=1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (property==\"og:description\") {\r\n\t\t\t\t\t\tdesc = $item.attr(\"content\");\r\n\t\t\t\t\t\tdescFound=1;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\t\r\n\t\t\t\t\r\n\t\t\t\tif (titleFound==0)\r\n\t\t\t\t{\r\n\t\t\t\t\t//var matches = body.match(/<title>\\s*(.+?)<\\/title>/);\r\n\t\t\t\t\tvar matches = body.match(/<title>\\s*(.+?)\\s*<\\/title>/);\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\ttitle = matches[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (imgFound===0) {\r\n\t\t\t\t\timage = $h.find('link[rel=\"image_src\"],link[rel=\"apple-touch-icon\"],link[rel=\"shortcut icon\"]').attr('href');\r\n\t\t\t\t\tif (image && image.indexOf('//')==-1) { // prepend baseurl for relative images\t\t\t\t\t\t\r\n\t\t\t\t\t\timage = baseUrl+image;\r\n\t\t\t\t\t}\r\n\t\t\t\t\timages.push(image);\r\n\t\t\t\t\timgFound = 1;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (descFound==0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$.each($h.find('meta[name=\"description\"]'),function(idx,item){\r\n\t\t\t\t\t\tdesc = $(item).attr(\"content\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$.each($h.find('meta[name=\"keywords\"]'),function(idx,item){\r\n\t\t\t\t\ttags.push($(item).attr(\"content\"));\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// find images\r\n\t\t\t\t//oURL = URL.parse(sURL);\r\n\t\t\t\tvar baseUrl = response.request.uri.href;\r\n\t\t\t\t\r\n\t\t\t\timgs = $h.find('img[src$=\"png\"],img[src$=\"jpg\"]');\r\n\t\t\t\t$.each(imgs,function(idx,item){\r\n\t\t\t\t\tsrc=$(item).attr(\"src\");\r\n\t\t\t\t\t//console.log(\"image src:\"+src);\r\n\t\t\t\t\t//src = imgs[i].getAttribute(\"src\");\r\n\t\t\t\t\tif (src.indexOf('//')==-1) { // prepend baseurl for relative images\t\t\t\t\t\t\r\n\t\t\t\t\t\tsrc=baseUrl+src;\r\n\t\t\t\t\t\t//console.log(\"image src put http:\"+src);\r\n\t\t\t\t\t}\r\n\t\t\t\t\timages.push(src);\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// find social usernames\r\n\t\t\t\t$.each($h.find('a[href*=\"twitter.com/\"]:not(a[href*=\"status\"])'),function(idx,item){\r\n\t\t\t\t\ttwUrl = $(item).attr(\"href\").replace('/#!','');\r\n\t\t\t\t\ttwUrl = URL.parse(twUrl,true,true);\r\n\t\t\t\t\tif (twUrl.query && twUrl.query.via){\r\n\t\t\t\t\t\ttw = twUrl.query.via;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (twUrl.query && twUrl.query.screen_name){\r\n\t\t\t\t\t\ttw = twUrl.query.screen_name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttw = twUrl.pathname;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//console.log(\"tw------\"+twUrl.query.via);\r\n\t\t\t\t\tif (tw===\"\" || tw === null || typeof tw === \"undefined\") {\r\n\t\t\t\t\t\ttw = \"in1_\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttw = \"@\"+tw.replace(\"/\",\"\");\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$.each($h.find('a[href*=\"facebook.com/\"]:not(a[href*=\"developers\"]):lt(1)'),function(idx,item){\r\n\t\t\t\t\tfbPagesUrl = $(item).attr(\"href\");\r\n\t\t\t\t\tfbPagesUrl = URL.parse(fbPagesUrl);\r\n\t\t\t\t\tfb = fbPagesUrl.pathname;\r\n\t\t\t\t\t//fb = fb.replace(\"/pages\",\"\");\r\n\t\t\t\t\tfb = fb.replace(\"/\",\"\");\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$.each($h.find('a[href*=\"linkedin.com/\"]:lt(1)'),function(idx,item){\r\n\t\t\t\t\tliUrl = $(item).attr(\"href\");\r\n\t\t\t\t\tliUrl = URL.parse(liUrl);\r\n\t\t\t\t\tli = liUrl.pathname;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$.each($h.find('a[href*=\"feeds.feedburner.com\"]:lt(1)'),function(idx,item){\r\n\t\t\t\t\trssUrl = $(item).attr(\"href\");\r\n\t\t\t\t\t//rssUrl = URL.parse(rssUrl);\r\n\t\t\t\t\t//rss = rssUrl.pathname;\r\n\t\t\t\t\trss = rssUrl;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$.each($h.find('a[href*=\"pinterest.com/\"]:not([href*=\"pin/create\"])'),function(idx,item){\r\n\t\t\t\t\tpinUrl = $(item).attr(\"href\");\r\n\t\t\t\t\tpinUrl = URL.parse(pinUrl);\r\n\t\t\t\t\tpin = pinUrl.pathname;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t$.each($h.find('a[href*=\"youtube.com/user/\"]'),function(idx,item){\r\n\t\t\t\t\tytUrl = $(item).attr(\"href\");\r\n\t\t\t\t\tytUrl = URL.parse(ytUrl);\r\n\t\t\t\t\tyt = ytUrl.pathname;\r\n\t\t\t\t\tyt = yt.replace(\"/user\",\"\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t//TODO: google+\r\n\t\r\n\t\t\t\t$h = null;\r\n\t\t\t\tres.json({title:title,desc:desc,images:images,tags:tags,tw:tw,facebook:fb,youtube:yt,linkedin:li,rss:rss,pinterest:pin});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tres.json({error:'problem harvesting:'+url});\r\n\t\t\t}\r\n\t\t});\t\r\n\t\r\n\t}\r\n\telse {\r\n\t\tres.json({error:'url is required'});\r\n\t}"],[0,"\r\n})"]],"start1":265,"start2":265,"length1":125,"length2":4580}]],"length":6566,"saved":false}
{"ts":1376134136497,"patch":[[{"diffs":[[0,"'./conf'),\r\n"],[1,"    window = require(\"jsdom\").jsdom().createWindow()\r\n    $ = require(\"jquery\")\r\n"],[0,"    request "]],"start1":130,"start2":130,"length1":24,"length2":105},{"diffs":[[0,".url"],[-1,";\r\n   \r\n   var url = req.param(\"url\")"],[0,",\r\n "]],"start1":472,"start2":472,"length1":45,"length2":8}]],"length":6610,"saved":false}
{"ts":1376134140278,"patch":[[{"diffs":[[0,"Window()"],[1,","],[0,"\r\n    $ "]],"start1":186,"start2":186,"length1":16,"length2":17},{"diffs":[[0,"jquery\")"],[1,","],[0,"\r\n    re"]],"start1":214,"start2":214,"length1":16,"length2":17}]],"length":6612,"saved":false}
{"ts":1376134159308,"patch":[[{"diffs":[[0,"ire("],[-1,"\""],[1,"'"],[0,"jsdom"],[-1,"\""],[1,"'"],[0,").js"]],"start1":159,"start2":159,"length1":15,"length2":15},{"diffs":[[0,"ire("],[-1,"\""],[1,"'"],[0,"jquery"],[-1,"\""],[1,"'"],[0,"),\r\n"]],"start1":209,"start2":209,"length1":16,"length2":16}]],"length":6612,"saved":false}
{"ts":1376134336438,"patch":[[{"diffs":[[0,"    "],[-1,"\t"],[0,"title,\r\n"],[-1,"\t"],[0,"\tdesc,\r\n"],[-1,"\t"],[0,"\tima"]],"start1":481,"start2":481,"length1":27,"length2":24},{"diffs":[[0,"image,\r\n"],[-1,"\t"],[0,"\timages="]],"start1":502,"start2":502,"length1":17,"length2":16},{"diffs":[[0,"es=[],\r\n"],[-1,"\t"],[0,"\ttags=[]"]],"start1":515,"start2":515,"length1":17,"length2":16},{"diffs":[[0,"gs=[],\r\n"],[-1,"\t"],[0,"\ttw,fb,r"]],"start1":526,"start2":526,"length1":17,"length2":16},{"diffs":[[0,"in,yt,\r\n"],[-1,"\t"],[0,"\ttitleFo"]],"start1":549,"start2":549,"length1":17,"length2":16},{"diffs":[[0,"und=0,\r\n"],[-1,"\t"],[0,"\tdescFou"]],"start1":565,"start2":565,"length1":17,"length2":16},{"diffs":[[0,"und=0,\r\n"],[-1,"\t"],[0,"\timgFoun"]],"start1":580,"start2":580,"length1":17,"length2":16},{"diffs":[[0,"ror) {\r\n\t\t\t\t"],[1,"var "],[0,"$h = $(\"<for"]],"start1":761,"start2":761,"length1":24,"length2":28},{"diffs":[[0,"{\r\n\t\t\t\t\t"],[1,"var "],[0,"$item = "]],"start1":902,"start2":902,"length1":16,"length2":20},{"diffs":[[0,";\r\n\t\t\t\t\t"],[1,"var "],[0,"property"]],"start1":929,"start2":929,"length1":16,"length2":20},{"diffs":[[0,"titleFound=="],[1,"="],[0,"0)\r\n\t\t\t\t{\r\n\t"]],"start1":1485,"start2":1485,"length1":24,"length2":25},{"diffs":[[0,"cFound=="],[1,"="],[0,"0)\r\n\t\t\t\t"]],"start1":2043,"start2":2043,"length1":16,"length2":17},{"diffs":[[0,"\t\t\r\n\t\t\t\t"],[1,"var "],[0,"imgs = $"]],"start1":2411,"start2":2411,"length1":16,"length2":20},{"diffs":[[0,"tem){\r\n\t\t\t\t\t"],[1,"var "],[0,"src=$(item)."]],"start1":2505,"start2":2505,"length1":24,"length2":28},{"diffs":[[0,"tem){\r\n\t\t\t\t\t"],[1,"var "],[0,"twUrl = $(it"]],"start1":2942,"start2":2942,"length1":24,"length2":28},{"diffs":[[0,"tem){\r\n\t\t\t\t\t"],[1,"var "],[0,"fbPagesUrl ="]],"start1":3565,"start2":3565,"length1":24,"length2":28},{"diffs":[[0,"tem){\r\n\t\t\t\t\t"],[1,"var "],[0,"liUrl = $(it"]],"start1":3842,"start2":3842,"length1":24,"length2":28},{"diffs":[[0,"{\r\n\t\t\t\t\t"],[1,"var "],[0,"rssUrl ="]],"start1":4041,"start2":4041,"length1":16,"length2":20},{"diffs":[[0,"tem){\r\n\t\t\t\t\t"],[1,"var "],[0,"pinUrl = $(i"]],"start1":4275,"start2":4275,"length1":24,"length2":28},{"diffs":[[0,"item){\r\n"],[-1,""],[0,"\t\t\t\t\t"],[1,"var "],[0,"ytUrl = "]],"start1":4465,"start2":4465,"length1":21,"length2":25}]],"length":6649,"saved":false}
{"ts":1376134435145,"patch":[[{"diffs":[[0,",res){ \r"],[1,"\n\r\n    var URL = require('url');\r"],[0,"\n    \r\n"],[1," "],[0,"   var u"]],"start1":437,"start2":437,"length1":23,"length2":57}]],"length":6683,"saved":false}
{"ts":1376134702172,"patch":[[{"diffs":[[0,"nescape("],[1,"fixUrl("],[0,"url)"],[1,")"],[0,";\r\n\t\t\r\n\t"]],"start1":669,"start2":669,"length1":20,"length2":28}]],"length":6691,"saved":false}
{"ts":1376134735049,"patch":[[{"diffs":[[0,"nescape("],[1,"utils."],[0,"fixUrl(u"]],"start1":669,"start2":669,"length1":16,"length2":22}]],"length":6697,"saved":false}
{"ts":1376134788292,"patch":[[{"diffs":[[0,"){\r\n\t\t\t\t"],[-1,"\t"],[1,"    "],[0,"tags.pus"]],"start1":2299,"start2":2299,"length1":17,"length2":20}]],"length":6700,"saved":false}
{"ts":1376135247845,"patch":[[{"diffs":[[0,"h = $(\"<"],[-1,"form"],[1,"iframe"],[0,">\"+body+"]],"start1":826,"start2":826,"length1":20,"length2":22},{"diffs":[[0,"+\"</"],[-1,"form"],[1,"iframe"],[0,">\");"]],"start1":847,"start2":847,"length1":12,"length2":14}]],"length":6704,"saved":false}
{"ts":1376135336615,"patch":[[{"diffs":[[0,"ion(idx,item){\r\n"],[1,"                    \r\n                    console.log(\"meta og......\");                    \r\n                    \r\n"],[0,"\t\t\t\t\tvar $item ="]],"start1":941,"start2":941,"length1":32,"length2":147},{"diffs":[[0,"=0)\r\n\t\t\t\t{\r\n"],[1,"                    console.log(\"title......\");                    \r\n                    \r\n                    \r\n"],[0,"\t\t\t\t\t//var m"]],"start1":1664,"start2":1664,"length1":24,"length2":137},{"diffs":[[0,"\n\t\t\t\t{\r\n"],[1,"                    console.log(\"meta desc......\");                    \r\n                    \r\n"],[0,"\t\t\t\t\t$.e"]],"start1":2335,"start2":2335,"length1":16,"length2":111},{"diffs":[[0,"idx,item){\r\n"],[1,"                        console.log(\"meta desc..\");         \r\n"],[0,"\t\t\t\t\t\tdesc ="]],"start1":2495,"start2":2495,"length1":24,"length2":86},{"diffs":[[0," usernames\r\n"],[-1,""],[0,"\t\t\t\t$.each($"]],"start1":3287,"start2":3287,"length1":24,"length2":24},{"diffs":[[0,"ion(idx,item){\r\n"],[1,"                    \r\n                     console.log(\"twitter found......\");  \r\n                    \r\n"],[0,"\t\t\t\t\tvar twUrl ="]],"start1":3373,"start2":3373,"length1":32,"length2":136}]],"length":7193,"saved":false}
{"ts":1376135338969,"patch":[[{"diffs":[[0,"                "],[-1," "],[0,"console.log(\"twi"]],"start1":3415,"start2":3415,"length1":33,"length2":32}]],"length":7192,"saved":false}
{"ts":1376135476922,"patch":[[{"diffs":[[0,"function(req,res"],[-1,",next"],[0,"){\r\n    console."]],"start1":5547,"start2":5547,"length1":37,"length2":32},{"diffs":[[0,"        "],[1,"//"],[0,"next();\r"]],"start1":5987,"start2":5987,"length1":16,"length2":18},{"diffs":[[0,",res"],[-1,",next"],[0,"){\r\n"]],"start1":6068,"start2":6068,"length1":13,"length2":8}]],"length":7184,"saved":false}
{"ts":1376135522404,"patch":[[{"diffs":[[0,"ta[name="],[-1,"\""],[0,"descript"]],"start1":2461,"start2":2461,"length1":17,"length2":16},{"diffs":[[0,"cription"],[-1,"\""],[0,"]'),func"]],"start1":2472,"start2":2472,"length1":17,"length2":16}]],"length":7182,"saved":false}
{"ts":1376135525305,"patch":[[{"diffs":[[0,"ame="],[-1,"\""],[0,"keywords"],[-1,"\""],[0,"]'),"]],"start1":2651,"start2":2651,"length1":18,"length2":16}]],"length":7180,"saved":false}
{"ts":1376135613596,"patch":[[{"diffs":[[0,"p.get('/"],[1,"fff/"],[0,":id/:siz"]],"start1":6031,"start2":6031,"length1":16,"length2":20}]],"length":7184,"saved":false}
{"ts":1376135673917,"patch":[[{"diffs":[[0,"iframe>\");\r\n"],[1,"                \r\n                console.log($h.html());\r\n"],[0,"\t\t\t\t\r\n\t\t\t\t//"]],"start1":851,"start2":851,"length1":24,"length2":83},{"diffs":[[0,"ta desc......\");"],[1,"              \r\n                    \r\n"],[0,"                "]],"start1":2437,"start2":2437,"length1":32,"length2":70}]],"length":7281,"saved":false}
{"ts":1376135773673,"patch":[[{"diffs":[[0,"ole.log("],[1,"\"body----------------------------------\"+"],[0,"$h.html("]],"start1":901,"start2":901,"length1":16,"length2":57}]],"length":7322,"saved":false}
{"ts":1376147505263,"patch":[[{"diffs":[[0,"h = $(\"<"],[-1,"iframe"],[1,"form"],[0,">\"+body+"]],"start1":826,"start2":826,"length1":22,"length2":20},{"diffs":[[0,"+\"</"],[-1,"iframe"],[1,"form"],[0,">\");"]],"start1":845,"start2":845,"length1":14,"length2":12}]],"length":7318,"saved":false}
{"ts":1376147536465,"patch":[[{"diffs":[[0,",pin,yt,"],[1,"gp,"],[0,"\r\n\ttitle"]],"start1":581,"start2":581,"length1":16,"length2":19}]],"length":7321,"saved":false}
{"ts":1376147780270,"patch":[[{"diffs":[[0,"              \r\n"],[1,"                var head = body.match(/<head>\\s*(.+?)\\s*<\\/head>/);\r\n                if (head) {\r\n    \t\t\t\t\t$h = $(\"<form>\"+head[1]+\"</form>\");\r\n\t\t\t\t\t}\r\n                \r\n"],[0,"                "]],"start1":864,"start2":864,"length1":32,"length2":202}]],"length":7491,"saved":false}
{"ts":1376215481605,"patch":[[{"diffs":[[0,"(!error) {\r\n"],[1,"                \r\n                console.log(body;\r\n    \t\t\t\r\n                \r\n"],[0,"\t\t\t\tvar $h ="]],"start1":808,"start2":808,"length1":24,"length2":104}]],"length":7571,"saved":false}
{"ts":1376215481706,"patch":[[{"diffs":[[0,"log(body"],[1,")"],[0,";\r\n    \t"]],"start1":862,"start2":862,"length1":16,"length2":17}]],"length":7572,"saved":false}
{"ts":1376215497458,"patch":[[{"diffs":[[0,"f (head) {\r\n"],[1,"                        console.log(head[0]);\r\n"],[0,"    \t\t\t\t\t$h "]],"start1":1047,"start2":1047,"length1":24,"length2":71}]],"length":7619,"saved":false}
{"ts":1376216217093,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"console.log(body"]],"start1":838,"start2":838,"length1":32,"length2":34},{"diffs":[[0,"d>\\s"],[-1,"*"],[0,"(.+?)\\s"],[-1,"*"],[0,"<\\/head>"],[-1,"/"],[0,");\r\n"]],"start1":1006,"start2":1006,"length1":26,"length2":23},{"diffs":[[0,"ole.log("],[1,"\"head............\"+"],[0,"head[0])"]],"start1":1086,"start2":1086,"length1":16,"length2":35}]],"length":7637,"saved":false}
{"ts":1376216446083,"patch":[[{"diffs":[[0,"<\\/head>"],[1,"\\"],[0,");\r\n    "]],"start1":1017,"start2":1017,"length1":16,"length2":17}]],"length":7638,"saved":false}
{"ts":1376216636965,"patch":[[{"diffs":[[0,"<\\/head>"],[-1,"\\"],[1,"/"],[0,");\r\n    "]],"start1":1017,"start2":1017,"length1":17,"length2":17}]],"length":7638,"saved":false}
{"ts":1376216658094,"patch":[[{"diffs":[[0,"ead>"],[-1,"\\s"],[0,"(.+?)"],[-1,"\\s"],[0,"<\\/h"]],"start1":1004,"start2":1004,"length1":17,"length2":13}]],"length":7634,"saved":false}
{"ts":1376216760328,"patch":[[{"diffs":[[0,"(/<head>"],[-1,"(.+?)"],[1,"[\\s\\S]"],[0,"<\\/head>"]],"start1":1000,"start2":1000,"length1":21,"length2":22}]],"length":7635,"saved":false}
{"ts":1376216876288,"patch":[[{"diffs":[[0,"d>[\\"],[-1,"s\\S"],[1,"S\\s"],[0,"]<\\/"]],"start1":1006,"start2":1006,"length1":11,"length2":11}]],"length":7635,"saved":false}
{"ts":1376216884086,"patch":[[{"diffs":[[0,"\\/head>/"],[1,"g"],[0,");\r\n    "]],"start1":1015,"start2":1015,"length1":16,"length2":17}]],"length":7636,"saved":false}
{"ts":1376217023114,"patch":[[{"diffs":[[0,"    if ("],[-1,"head"],[1,"typeof head != \"undefined\""],[0,") {\r\n   "]],"start1":1040,"start2":1040,"length1":20,"length2":42}]],"length":7658,"saved":false}
{"ts":1376217142052,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,"console."]],"start1":846,"start2":846,"length1":18,"length2":16},{"diffs":[[0,"ole.log(body"],[1,".substring(0,400)"],[0,");\r\n    \t\t\t\r"]],"start1":858,"start2":858,"length1":24,"length2":41}]],"length":7673,"saved":false}
{"ts":1376217147228,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"console.log(\"hea"]],"start1":1102,"start2":1102,"length1":32,"length2":34},{"diffs":[[0,";\r\n    \t\t\t\t\t"],[1,"//"],[0,"$h = $(\"<for"]],"start1":1159,"start2":1159,"length1":24,"length2":26}]],"length":7677,"saved":false}
{"ts":1376217386088,"patch":[[{"diffs":[[0,");\r\n\t\t\t\t\t}\r\n"],[1,"                    \r\n                    \r\n                var pattern = /<head[^>]*>((.|[\\n\\r])*)<\\/head>/im\r\n                var array_matches = pattern.exec(body);   \r\n                \r\n                 console.log(array_matches[1]);\r\n"],[0,"            "]],"start1":1206,"start2":1206,"length1":24,"length2":263}]],"length":7916,"saved":false}
{"ts":1376217521431,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"console.log(body"]],"start1":838,"start2":838,"length1":32,"length2":34},{"diffs":[[0,"                "],[-1," "],[0,"console.log(arra"]],"start1":1410,"start2":1410,"length1":33,"length2":32},{"diffs":[[0,"ole.log("],[1,"\"head----\"+"],[0,"array_ma"]],"start1":1430,"start2":1430,"length1":16,"length2":27}]],"length":7928,"saved":false}
{"ts":1376217897830,"patch":[[{"diffs":[[0,"(.|[\\n\\r"],[1,"\\S\\s"],[0,"])*)<\\/h"]],"start1":1307,"start2":1307,"length1":16,"length2":20}]],"length":7932,"saved":false}
{"ts":1376218163840,"patch":[[{"diffs":[[0,".|[\\"],[-1,"n\\r\\"],[0,"S\\s]"]],"start1":1308,"start2":1308,"length1":12,"length2":8}]],"length":7928,"saved":false}
{"ts":1376218373961,"patch":[[{"diffs":[[0,"\\/head>/"],[-1,"g"],[1,"im"],[0,");\r\n    "]],"start1":1032,"start2":1032,"length1":17,"length2":18},{"diffs":[[0,"                "],[-1,"    //"],[0,"console.log(\"hea"]],"start1":1101,"start2":1101,"length1":38,"length2":32},{"diffs":[[0,"..\"+head"],[-1,"[0]"],[0,");\r\n    "]],"start1":1144,"start2":1144,"length1":19,"length2":16},{"diffs":[[0,"    \t\t\t\t"],[-1,"\t"],[0,"//$h = $"]],"start1":1156,"start2":1156,"length1":17,"length2":16},{"diffs":[[0,"</form>\");\r\n"],[-1,"\t"],[0,"\t\t\t\t}\r\n     "]],"start1":1191,"start2":1191,"length1":25,"length2":24},{"diffs":[[0,"            "],[1,"//"],[0,"var pattern "]],"start1":1258,"start2":1258,"length1":24,"length2":26},{"diffs":[[0,"            "],[1,"//"],[0,"var array_ma"]],"start1":1328,"start2":1328,"length1":24,"length2":26},{"diffs":[[0,"                "],[1,"//"],[0,"console.log(\"hea"]],"start1":1404,"start2":1404,"length1":32,"length2":34}]],"length":7924,"saved":false}
{"ts":1376218705494,"patch":[[{"diffs":[[0,"(/<head>"],[1,"((.|"],[0,"[\\S\\s]"],[1,")*)"],[0,"<\\/head>"]],"start1":1017,"start2":1017,"length1":22,"length2":29}]],"length":7931,"saved":false}
{"ts":1376219057889,"patch":[[{"diffs":[[0,"            "],[1,"//"],[0," var head = "]],"start1":983,"start2":983,"length1":24,"length2":26},{"diffs":[[0,"head>/im);\r\n"],[1,"                /*\r\n"],[0,"            "]],"start1":1043,"start2":1043,"length1":24,"length2":44},{"diffs":[[0,"                "],[1,"*/"],[0,"  \r\n            "]],"start1":1241,"start2":1241,"length1":32,"length2":34},{"diffs":[[0,"            "],[-1,"//"],[0,"var pattern "]],"start1":1289,"start2":1289,"length1":26,"length2":24},{"diffs":[[0,"        "],[-1,"//"],[0,"var arra"]],"start1":1361,"start2":1361,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1," "],[-1,"\r\n                //"],[1," "],[0,"console."]],"start1":1420,"start2":1420,"length1":37,"length2":17}]],"length":7931,"saved":false}
{"ts":1376219129802,"patch":[[{"diffs":[[0,"[^>]*>((.|[\\"],[-1,"S\\s"],[1,"n\\r"],[0,"])*)<\\/head>"]],"start1":1321,"start2":1321,"length1":27,"length2":27}]],"length":7931,"saved":false}
{"ts":1376219290216,"patch":[[{"diffs":[[0,"                "],[1,"var $h = $(\"<form>\"+array_matches[1]+\"</form>\");\r\n                \r\n                //"],[0,"console.log(\"bod"]],"start1":1490,"start2":1490,"length1":32,"length2":118}]],"length":8017,"saved":false}
{"ts":1376219352388,"patch":[[{"diffs":[[0,"tches[1]"],[1,"replace(/\\n/g,\" \")"],[0,"+\"</form"]],"start1":1534,"start2":1534,"length1":16,"length2":34}]],"length":8035,"saved":false}
{"ts":1376219361148,"patch":[[{"diffs":[[0,"tches[1]"],[1,"."],[0,"replace("]],"start1":1534,"start2":1534,"length1":16,"length2":17}]],"length":8036,"saved":false}
{"ts":1376219462012,"patch":[[{"diffs":[[0,"\t\t\t\t"],[-1,"var $h = $(\"<form>\"+body+\"</form>\");\r\n                \r\n               // var head = body.match(/<head>((.|[\\S\\s])*)<\\/head>/im);\r\n                /*\r\n                if (typeof head != \"undefined\") {\r\n                    console.log(\"head............\"+head);\r\n    \t\t\t\t//$h = $(\"<form>\"+head[1]+\"</form>\");\r\n\t\t\t\t}\r\n                  */  \r\n                    \r\n                var pattern = /<head[^>]*>((.|[\\n\\r])*)<\\/head>/im\r\n                var array_matches = pattern.exec(body);   \r\n                console.log(\"head----\"+array_matches[1]);"],[1,"//var $h = $(\"<form>\"+body+\"</form>\");\r\n                \r\n                    \r\n                var headPattern = /<head[^>]*>((.|[\\n\\r])*)<\\/head>/im\r\n                var headMatches = headPattern.exec(body);\r\n                \r\n                if (headMatches.length>0) {\r\n                    var head = headMatches[1].replace(/\\n/g,\" \");\r\n                }"],[0,"\r\n  "]],"start1":920,"start2":920,"length1":554,"length2":366}]],"length":7848,"saved":false}
{"ts":1376219626017,"patch":[[{"diffs":[[0,"gth>0) {"],[-1,""],[0,""],[1," // head\r\n                    "],[0,"\r\n      "]],"start1":1188,"start2":1188,"length1":16,"length2":46},{"diffs":[[0,"    "],[-1,"}\r\n                \r\n                var $h = $(\"<form>\"+array_matches[1].replace(/\\n/g,\" \")+\"</form>\");\r\n                \r\n                //console.log(\"body----------------------------------\"+$h.html());\r\n\t\t\t\t\r\n\t\t\t\t// find opengraph\r\n\t\t\t\t$.each($h.find('meta[property^=\"og:\"]'),function(idx,item){\r\n                    \r\n                    console.log(\"meta og......\");                    \r\n                    \r\n\t\t\t\t\tvar $item = $(item);\r\n\t\t\t\t\tvar property = $item.attr(\"property\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (property==\"og:image\") {\r\n\t\t\t\t\t\timage = $item.attr(\"content\");\r\n\t\t\t\t\t\t//if (imgSrc.indexOf('//')==-1) { // prepend baseurl for relative images\t\t\t\t\t\t\r\n\t\t\t\t\t\t//\timgSrc=baseUrl+imgSrc;\r\n\t\t\t\t\t\t//}\r\n\t\t\t\t\t\timages.push(image);\r\n\t\t\t\t\t\timgFound = 1;\r\n\t\t\t\t\t}\t\t\t\r\n\t\t\t\t\telse if (property==\"og:title\") {\r\n\t\t\t\t\t\ttitle = $item.attr(\"content\");\r\n\t\t\t\t\t\ttitleFound=1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (property==\"og:description\") {\r\n\t\t\t\t\t\tdesc = $item.attr(\"content\");\r\n\t\t\t\t\t\tdescFound=1;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\t\r\n\t\t\t\t\r\n\t\t\t\tif (titleFound===0)\r\n\t\t\t\t{\r\n                    console.log(\"title......\");                    \r\n                    \r\n                    \r\n\t\t\t\t\t//var matches = body.match(/<title>\\s*(.+?)<\\/title>/);\r\n\t\t\t\t\tvar matches = body.match(/<title>\\s*(.+?)\\s*<\\/title>/);\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\ttitle = matches[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (imgFound===0) {\r\n\t\t\t\t\timage = $h.find('link[rel=\"image_src\"],link[rel=\"apple-touch-icon\"],link[rel=\"shortcut icon\"]').attr('href');\r\n\t\t\t\t\tif (image && image.indexOf('//')==-1) { // prepend baseurl for relative images\t\t\t\t\t\t\r\n\t\t\t\t\t\timage = baseUrl+image;\r\n\t\t\t\t\t}\r\n\t\t\t\t\timages.push(image);\r\n\t\t\t\t\timgFound = 1;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (descFound===0)\r\n\t\t\t\t{\r\n                    console.log(\"meta desc......\");              \r\n                    \r\n                    \r\n                    \r\n\t\t\t\t\t$.each($h.find('meta[name=description]'),function(idx,item){\r\n                        console.log(\"meta desc..\");         \r\n\t\t\t\t\t\tdesc = $(item).attr(\"content\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$.each($h.find('meta[name=keywords]'),function(idx,item){\r\n\t\t\t\t    tags.push($(item).attr(\"content\"));\r\n\t\t\t\t});"],[1,"    var $h = $(\"<form>\"+head+\"</form>\");\r\n                    \r\n                    // find opengraph\r\n                    $.each($h.find('meta[property^=\"og:\"]'),function(idx,item){\r\n                        \r\n                        console.log(\"meta og......\");                    \r\n                        \r\n                        var $item = $(item);\r\n                        var property = $item.attr(\"property\");\r\n                        \r\n                        if (property==\"og:image\") {\r\n                            image = $item.attr(\"content\");\r\n                            images.push(image);\r\n                            imgFound = 1;\r\n                        }\t\t\t\r\n                        else if (property==\"og:title\") {\r\n                            title = $item.attr(\"content\");\r\n                            titleFound=1;\r\n                        }\r\n                        else if (property==\"og:description\") {\r\n                            desc = $item.attr(\"content\");\r\n                            descFound=1;\r\n                        }\r\n                    });\t\r\n    \t\t\t\t\r\n    \t\t\t\t//if (titleFound===0)\r\n    \t\t\t\t{\r\n                        console.log(\"title......\");\r\n                        \r\n                        var matches = body.match(/<title>\\s*(.+?)\\s*<\\/title>/);\r\n    \t\t\t        if (matches) {\r\n    \t\t\t            title = matches[1];\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t\t\r\n    \t\t\t\t//if (imgFound===0)\r\n                    {\r\n    \t\t\t\t\timage = $h.find('link[rel=\"image_src\"],link[rel=\"apple-touch-icon\"],link[rel=\"shortcut icon\"]').attr('href');\r\n    \t\t\t\t\tif (image && image.indexOf('//')==-1) { // prepend baseurl for relative images\t\t\t\t\t\t\r\n    \t\t\t\t\t\timage = baseUrl+image;\r\n    \t\t\t\t\t}\r\n    \t\t\t\t\timages.push(image);\r\n    \t\t\t\t\timgFound = 1;\r\n    \t\t\t\t}\r\n    \t\t\t\t\r\n    \t\t\t\t//if (descFound===0)\r\n    \t\t\t\t{\r\n                        console.log(\"meta desc......\");              \r\n                        \r\n                          \r\n    \t\t\t\t\t$.each($h.find('meta[name=description]'),function(idx,item){\r\n                            console.log(\"meta desc..\");         \r\n    \t\t\t\t\t\tdesc = $(item).attr(\"content\");\r\n    \t\t\t\t\t});\r\n    \t\t\t\t}\r\n    \r\n    \t\t\t\t$.each($h.find('meta[name=keywords]'),function(idx,item){\r\n    \t\t\t\t    tags.push($(item).attr(\"content\"));\r\n    \t\t\t\t});\r\n                }\r\n                \r\n                \r\n                \r\n                //console.log(\"body----------------------------------\"+$h.html());\r\n\t\t\t\t\r\n\t\t\t\t"],[0,"\r\n\t\t"]],"start1":1307,"start2":1307,"length1":2131,"length2":2474}]],"length":8221,"saved":false}
{"ts":1376219707406,"patch":[[{"diffs":[[0,"ref;\r\n\t\t\t\t\r\n"],[1,"                var bodyPattern = /<body[^>]*>((.|[\\n\\r])*)<\\/body>/im\r\n                var bodyMatches = bodyPattern.exec(body);\r\n                \r\n                if (bodyMatches.length>0) { // body\r\n                \r\n"],[0,"\t\t\t\tvar imgs"]],"start1":3876,"start2":3876,"length1":24,"length2":244}]],"length":8441,"saved":false}
{"ts":1376219737865,"patch":[[{"diffs":[[0,"          \r\n"],[1,"                \r\n                    var $h = $(\"<form>\"+bodyMatches[1]+\"</form>\");\r\n                \r\n"],[0,"\t\t\t\tvar imgs"]],"start1":4096,"start2":4096,"length1":24,"length2":128}]],"length":8545,"saved":false}
{"ts":1376219743860,"patch":[[{"diffs":[[0,"                "],[-1,"var "],[0,"$h = $(\"<form>\"+"]],"start1":4130,"start2":4130,"length1":36,"length2":32}]],"length":8541,"saved":false}
{"ts":1376219754825,"patch":[[{"diffs":[[0,"rn.exec(body);\r\n"],[1,"                var $h;\r\n"],[0,"                "]],"start1":1119,"start2":1119,"length1":32,"length2":57},{"diffs":[[0,"        "],[-1,"var "],[0,"$h = $(\""]],"start1":1332,"start2":1332,"length1":20,"length2":16}]],"length":8562,"saved":false}
